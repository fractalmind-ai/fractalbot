# FractalBot Configuration Example
# Copy this to config.yaml and customize for your setup

gateway:
  # Port for WebSocket server
  port: 18789
  # Bind address (127.0.0.1 for local only)
  bind: 127.0.0.1
  # Optional: restrict allowed WebSocket origins (scheme + host + optional port)
  # allowedOrigins:
  #   - "http://localhost:3000"

channels:
  # Telegram channel configuration
  telegram:
    enabled: true
    # Get from @BotFather on Telegram
    botToken: "your_bot_token_here"
    # Admin Telegram User ID (required for /adduser, /removeuser, /listusers)
    adminID: 5088760910
    # List of Telegram User IDs allowed to interact (admin will be auto-added)
    allowedUsers:
      - 1234567890

    # Mode controls how FractalBot receives Telegram updates.
    # - polling: long polling via getUpdates (recommended for local/dev)
    # - webhook: Telegram calls your HTTPS endpoint
    # If empty, FractalBot auto-selects (webhook if webhook* configured, else polling).
    mode: "polling"

    # Long polling settings (only used in mode: polling)
    pollingTimeoutSeconds: 25
    pollingLimit: 100
    # Persist next update offset (UpdateID+1) to avoid re-processing after restart
    pollingOffsetFile: "./workspace/telegram.offset"

    # Webhook server (local) (only used in mode: webhook)
    # If empty, webhook server will not start.
    webhookListenAddr: ""
    webhookPath: "/telegram/webhook"

    # Webhook registration (Telegram) (only used in mode: webhook)
    # Must be publicly reachable HTTPS URL.
    webhookPublicURL: ""
    # Verified via header: X-Telegram-Bot-Api-Secret-Token
    webhookSecretToken: ""
    # If true, FractalBot will call Telegram setWebhook() on startup.
    webhookRegisterOnStart: false
    # If true, FractalBot will call Telegram deleteWebhook() on shutdown.
    webhookDeleteOnStop: false

  # Slack channel configuration (optional)
  slack:
    enabled: false
    botToken: "xoxb-your-bot-token"
    appToken: "xapp-your-app-token"
    # Allowed Slack user IDs (DM-only; empty means deny all)
    allowedUsers:
      - "U12345678"

  # Feishu/Lark channel configuration (optional)
  feishu:
    enabled: false
    # App ID from Feishu/Lark developer console
    appId: "cli_xxx"
    # App Secret from Feishu/Lark developer console
    appSecret: "your_app_secret"
    # Domain: "feishu" (China) or "lark" (International)
    domain: "feishu"
    # Allowed Feishu open_id/user_id values
    allowedUsers:
      - "ou_xxxxx"

  # Discord channel configuration (optional)
  discord:
    enabled: false
    # Get from Discord Developer Portal
    token: "your-bot-token"
    # Allowed Discord user IDs (DM-only; empty means deny all)
    allowedUsers:
      - "123456789012345678"

agents:
  # Workspace directory for agent sessions
  workspace: ./workspace
  # Maximum concurrent agent sessions
  maxConcurrent: 4

  # Optional: oh-my-code integration (route Telegram messages to agent-manager)
  ohMyCode:
    # Set true for local demo (requires python3 + tmux + agent-manager in that workspace)
    enabled: false
    # Path to the oh-my-code repository
    workspace: "/home/elliot245/workspace/elliot245/oh-my-code"
    # Optional override (relative to workspace or absolute)
    agentManagerScript: ".claude/skills/agent-manager/scripts/main.py"
    # Which agent receives Telegram messages by default
    defaultAgent: "qa-1"
    # Optional allowlist for /agent routing (defaults to only defaultAgent)
    allowedAgents:
      - "qa-1"
      - "coder-a"
    # How long to wait for agent-manager output
    assignTimeoutSeconds: 90
    # Telegram lifecycle commands:
    # - /agents (list allowed agent names)
    # - /monitor <name> [lines] (show recent output, capped at 200 lines)
    # - /startagent <name> (admin only)
    # - /stopagent <name> (admin only)
    # - /doctor (admin only)
    # - /whoami (show your Telegram IDs)
    # - /ping (simple health check)

  # Optional: in-process runtime (Phase 3 skeleton)
  runtime:
    enabled: false
    # Allowed tool names (empty = deny all)
    allowedTools:
      - "echo"
      - "version"
    # Optional: cap runtime replies
    maxReplyChars: 2000
